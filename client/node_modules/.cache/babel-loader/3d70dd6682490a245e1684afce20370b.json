{"ast":null,"code":"const Drawing = socket => {\n  var canvas = document.getElementsByClassName('whiteboard')[0]; //var canvas = document.getElementById('canvas');\n\n  console.log(canvas);\n  var colors = document.getElementsByClassName('color');\n  var context = canvas.getContext('2d');\n  var current = {\n    color: 'black'\n  };\n  var drawing = false;\n  const actionHistory = [];\n  let actionPointer = -1;\n\n  function putAction(data) {\n    if (actionHistory.length - 1 > actionPointer) {\n      actionHistory.splice(actionPointer + 1);\n    }\n\n    actionHistory.push(data);\n    actionPointer += 1;\n  }\n\n  ;\n\n  function onUndo() {\n    if (actionPointer < 0) {\n      return;\n    }\n\n    const action = actionHistory[actionPointer];\n    actionPointer -= 1;\n    socket.emit(\"hideLine\", {\n      id: action.id,\n      hidden: true\n    });\n  }\n\n  function redraw(data) {\n    const {\n      lineHist\n    } = data;\n    /* context.clearRect(\n        0,\n        0,\n        context.canvas.clientWidth,\n        context.canvas.clientHeight\n    ); */\n\n    for (const line of lineHist) {\n      drawLine(line, false);\n    }\n  }\n\n  socket.on(\"redraw\", redraw);\n  window.addEventListener(\"keydown\", event => {\n    if ((event.ctrlKey || event.metaKey) && !drawing) {\n      if (event.key === \"z\") {\n        onUndo();\n      }\n\n      ;\n    }\n\n    ;\n  });\n  canvas.addEventListener('mousedown', onMouseDown, false);\n  canvas.addEventListener('mouseup', onMouseUp, false);\n  canvas.addEventListener('mouseout', onMouseUp, false);\n  canvas.addEventListener('mousemove', throttle(onMouseMove, 10), false); //Touch support for mobile devices\n\n  canvas.addEventListener('touchstart', onMouseDown, false);\n  canvas.addEventListener('touchend', onMouseUp, false);\n  canvas.addEventListener('touchcancel', onMouseUp, false);\n  canvas.addEventListener('touchmove', throttle(onMouseMove, 10), false);\n\n  for (var i = 0; i < colors.length; i++) {\n    colors[i].addEventListener('click', onColorUpdate, false);\n  }\n\n  socket.on('drawing', onDrawingEvent);\n  window.addEventListener('resize', onResize, false);\n  onResize();\n\n  function drawLine(x0, y0, x1, y1, color, emit) {\n    context.beginPath();\n    context.moveTo(x0, y0);\n    context.lineTo(x1, y1);\n    context.strokeStyle = color;\n\n    if (color === 'white') {\n      context.lineWidth = 30;\n    } else {\n      context.lineWidth = 3;\n    }\n\n    context.stroke();\n    context.closePath();\n\n    if (!emit) {\n      return;\n    }\n\n    var w = canvas.width;\n    var h = canvas.height;\n    socket.emit('drawing', {\n      x0: x0 / w,\n      y0: y0 / h,\n      x1: x1 / w,\n      y1: y1 / h,\n      color: color\n    });\n  }\n\n  function onMouseDown(e) {\n    drawing = true;\n    current.x = e.clientX || e.touches[0].clientX;\n    current.y = e.clientY || e.touches[0].clientY;\n  }\n\n  function onMouseUp(e) {\n    if (!drawing) {\n      return;\n    }\n\n    drawing = false;\n    drawLine(current.x, current.y, e.clientX || e.touches[0].clientX, e.clientY || e.touches[0].clientY, current.color, true);\n    putAction({\n      act: 'drawing',\n      id: current.id\n    });\n  }\n\n  function onMouseMove(e) {\n    if (!drawing) {\n      return;\n    }\n\n    drawLine(current.x, current.y, e.clientX || e.touches[0].clientX, e.clientY || e.touches[0].clientY, current.color, true);\n    current.x = e.clientX || e.touches[0].clientX;\n    current.y = e.clientY || e.touches[0].clientY;\n  }\n\n  function onColorUpdate(e) {\n    current.color = e.target.className.split(' ')[1];\n  } // limit the number of events per second\n\n\n  function throttle(callback, delay) {\n    var previousCall = new Date().getTime();\n    return function () {\n      var time = new Date().getTime();\n\n      if (time - previousCall >= delay) {\n        previousCall = time;\n        callback.apply(null, arguments);\n      }\n    };\n  }\n\n  function onDrawingEvent(data) {\n    if (data.hidden) return;\n    var w = canvas.width;\n    var h = canvas.height;\n    drawLine(data.x0 * w, data.y0 * h, data.x1 * w, data.y1 * h, data.color);\n  } // make the canvas fill its parent\n\n\n  function onResize() {\n    canvas.width = window.innerWidth;\n    canvas.height = window.innerHeight;\n  }\n};\n\n_c = Drawing;\nexport default Drawing;\n\nvar _c;\n\n$RefreshReg$(_c, \"Drawing\");","map":{"version":3,"sources":["/Users/jdszsl/Desktop/projects/wb/real-time-whiteboard/client/src/components/whiteboard/drawing/drawing.js"],"names":["Drawing","socket","canvas","document","getElementsByClassName","console","log","colors","context","getContext","current","color","drawing","actionHistory","actionPointer","putAction","data","length","splice","push","onUndo","action","emit","id","hidden","redraw","lineHist","line","drawLine","on","window","addEventListener","event","ctrlKey","metaKey","key","onMouseDown","onMouseUp","throttle","onMouseMove","i","onColorUpdate","onDrawingEvent","onResize","x0","y0","x1","y1","beginPath","moveTo","lineTo","strokeStyle","lineWidth","stroke","closePath","w","width","h","height","e","x","clientX","touches","y","clientY","act","target","className","split","callback","delay","previousCall","Date","getTime","time","apply","arguments","innerWidth","innerHeight"],"mappings":"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","sourcesContent":["const Drawing = (socket) => {\n    var canvas = document.getElementsByClassName('whiteboard')[0];\n    //var canvas = document.getElementById('canvas');\n    console.log(canvas)\n    var colors = document.getElementsByClassName('color');\n    var context = canvas.getContext('2d');\n\n    var current = {\n        color: 'black'\n    };\n    var drawing = false;\n\n    const actionHistory = [];\n    let actionPointer = -1;\n\n    function putAction(data) {\n        if (actionHistory.length - 1 > actionPointer) {\n            actionHistory.splice(actionPointer + 1);\n        }\n        actionHistory.push(data);\n        actionPointer += 1;\n    };\n\n    function onUndo() {\n        if (actionPointer < 0) {\n            return;\n        }\n        const action = actionHistory[actionPointer];\n        actionPointer -= 1;\n        socket.emit(\"hideLine\", { id: action.id, hidden: true });\n    }\n\n    function redraw(data) {\n        const { lineHist } = data;\n        /* context.clearRect(\n            0,\n            0,\n            context.canvas.clientWidth,\n            context.canvas.clientHeight\n        ); */\n        for (const line of lineHist) {\n            drawLine(line, false);\n        }\n    }\n\n    socket.on(\"redraw\", redraw);\n\n    window.addEventListener(\"keydown\", (event) => {\n        if ((event.ctrlKey || event.metaKey) && !drawing) {\n            if (event.key === \"z\") {\n                onUndo();\n            };\n        };\n    });\n\n    canvas.addEventListener('mousedown', onMouseDown, false);\n    canvas.addEventListener('mouseup', onMouseUp, false);\n    canvas.addEventListener('mouseout', onMouseUp, false);\n    canvas.addEventListener('mousemove', throttle(onMouseMove, 10), false);\n\n    //Touch support for mobile devices\n    canvas.addEventListener('touchstart', onMouseDown, false);\n    canvas.addEventListener('touchend', onMouseUp, false);\n    canvas.addEventListener('touchcancel', onMouseUp, false);\n    canvas.addEventListener('touchmove', throttle(onMouseMove, 10), false);\n\n    for (var i = 0; i < colors.length; i++) {\n        colors[i].addEventListener('click', onColorUpdate, false);\n    }\n\n    socket.on('drawing', onDrawingEvent);\n\n    window.addEventListener('resize', onResize, false);\n    onResize();\n\n\n    function drawLine(x0, y0, x1, y1, color, emit) {\n        context.beginPath();\n        context.moveTo(x0, y0);\n        context.lineTo(x1, y1);\n        context.strokeStyle = color;\n        if(color === 'white'){\n            context.lineWidth = 30;\n        } else{\n            context.lineWidth = 3;\n        }\n        context.stroke();\n        context.closePath();\n\n        if (!emit) { return; }\n        var w = canvas.width;\n        var h = canvas.height;\n\n        socket.emit('drawing', {\n            x0: x0 / w,\n            y0: y0 / h,\n            x1: x1 / w,\n            y1: y1 / h,\n            color: color\n        });\n    }\n\n    function onMouseDown(e) {\n        drawing = true;\n        current.x = e.clientX || e.touches[0].clientX;\n        current.y = e.clientY || e.touches[0].clientY;\n    }\n\n    function onMouseUp(e) {\n        if (!drawing) { return; }\n        drawing = false;\n        drawLine(current.x, current.y, e.clientX || e.touches[0].clientX, e.clientY || e.touches[0].clientY, current.color, true);\n        putAction({ act: 'drawing', id: current.id });\n    }\n\n    function onMouseMove(e) {\n        if (!drawing) { return; }\n        drawLine(current.x, current.y, e.clientX || e.touches[0].clientX, e.clientY || e.touches[0].clientY, current.color, true);\n        current.x = e.clientX || e.touches[0].clientX;\n        current.y = e.clientY || e.touches[0].clientY;\n    }\n\n    function onColorUpdate(e) {\n        current.color = e.target.className.split(' ')[1];\n    }\n\n    // limit the number of events per second\n    function throttle(callback, delay) {\n        var previousCall = new Date().getTime();\n        return function () {\n            var time = new Date().getTime();\n\n            if ((time - previousCall) >= delay) {\n                previousCall = time;\n                callback.apply(null, arguments);\n            }\n        };\n    }\n\n    function onDrawingEvent(data) {\n        if (data.hidden) return;\n        var w = canvas.width;\n        var h = canvas.height;\n        drawLine(data.x0 * w, data.y0 * h, data.x1 * w, data.y1 * h, data.color);\n    }\n\n    // make the canvas fill its parent\n    function onResize() {\n        canvas.width = window.innerWidth;\n        canvas.height = window.innerHeight;\n    }\n\n};\n\nexport default Drawing;\n"]},"metadata":{},"sourceType":"module"}